{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Home</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: "Segoe UI", sans-serif;
        background: #f0f2f5;
      }

      /* Navbar */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: #2c3e50;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 30px;
        z-index: 1000;
      }

      .logo {
        color: #ecf0f1;
        font-size: 22px;
        font-weight: bold;
      }

      .navbar a {
        color: #ecf0f1;
        text-decoration: none;
        margin-left: 15px;
      }

      /* Sidebar */
      .sidebar {
        width: 200px;
        height: calc(100vh - 60px);
        background-color: #2c3e50;
        padding-top: 20px;
        position: fixed;
        top: 60px;
        left: 0;
      }

      .box {
        background-color: #3cb371;
        color: white;
        padding: 20px;
        margin: 10px;
        text-align: center;
        border-radius: 8px;
      }

      /* Main content */
      .main-content {
        margin-left: 200px;
        margin-top: 60px;
        height: calc(100vh - 60px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .button-container {
        display: grid;
        grid-template-columns: repeat(2, 200px);
        gap: 20px;
      }

      .btn {
        padding: 15px;
        background-color: #4caf50;
        color: white;
        text-decoration: none;
        border-radius: 10px;
        text-align: center;
      }

      /* ================= CHATBOT ================= */

      #chatbot-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #4caf50;
        color: white;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 2000;
      }

      #chatbot-popup {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 300px;
        height: 380px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        display: none;
        flex-direction: column;
        z-index: 2000;
      }

      .chat-header {
        background: #2c3e50;
        color: white;
        padding: 10px;
        display: flex;
        justify-content: space-between;
      }

      .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 14px;
      }

      .chat-footer {
        display: flex;
        border-top: 1px solid #ddd;
      }

      .chat-footer input {
        flex: 1;
        padding: 8px;
        border: none;
        outline: none;
      }

      .chat-footer button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 8px 12px;
      }

      .user-msg {
        text-align: right;
        margin: 5px 0;
      }

      .bot-msg {
        text-align: left;
        margin: 5px 0;
        color: #16a085;
      }

      a { 
        text-decoration: none;
      }

      .main-content{
  margin-left:220px;
  margin-top:60px;
  height:calc(100vh - 60px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

.dashboard-grid{
  display:grid;
  grid-template-columns:repeat(2,250px);
  gap:20px;
}

.card{
  background:white;
  padding:20px;
  border-radius:10px;
  text-align:center;
  box-shadow:0 3px 10px rgba(0,0,0,.2);
}

.card h2{
  margin:10px 0;
  color:#2c3e50;
}
a{
  text-decoration: none;
  color: black;
}
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <div class="navbar">
      <div class="logo">Lexicon</div>
      <div>
        <a href="{% url 'student_home' %}">Home</a>
        <a href="{% url 'profile' %}">Profile</a>
        <a href="{% url 'log_out' %}">Logout</a>
      </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
      <!-- <a href="{% url 'all_borrow' %}"><div class="box">Borrow Books<br /></div></a> -->
      <a href="{% url 'over_due' %}"><div class="box">Overdue Books<br />{{ overdue_count }}</div></a>
      <!-- <a href="#"><div class="box">History<br />{{ count_book }}</div></a> -->
      <!-- <div class="box">Students<br />{{ student_count }}</div> -->
    </div>

    <!-- MAIN -->
   
<!-- ================= MAIN BODY ================= -->
<div class="main-content">

<h1>Welcome {{ request.user }}</h1>

<div class="dashboard-grid">
  <a href="{% url 'tomorrow_return' %}">
  <div class="card">
    <h3>ðŸ“š Return Tomorrow</h3>
    <h2>{% if tomorrow_return %}{{ tomorrow_return }}{% else %}0{% endif %}</h2>
  </div>
  </a>

  <div class="card">
    <h3>ðŸ’° Total Penalty</h3>
    <h2>â‚¹ {{ total_penalty }}</h2>
  </div>

  <a href="{% url 'all_borrow' %}">
  <div class="card">
    <h3>âœ… Currently Borrowed</h3>
    <h2>{% if current_borrow %}{{ current_borrow }}{% else %}0{% endif %}</h2>
  </div>
  </a>

  <a href="{% url 'hostory' %}">
  <div class="card">
    <h3>ðŸ“– History</h3>
    <h2>{{history_count}} </h2>
  </div>
  </a>

</div>

</div>

    <!-- CHATBOT -->
    <div id="chatbot-btn">ðŸ’¬</div>

    <div id="chatbot-popup">
      <div class="chat-header">
        <span>Library Bot</span>
        <button onclick="closeChat()">âœ–</button>
      </div>

      <div class="chat-body" id="chat-body">
        <div class="bot-msg">Hello! Ask me anything ðŸ“š</div>
      </div>

      <div class="chat-footer">
        <input type="text" name="user_input" id="chat-input" placeholder="Type..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <script>
      const popup = document.getElementById("chatbot-popup");
      const body = document.getElementById("chat-body");
      const input = document.getElementById("chat-input");

      document.getElementById("chatbot-btn").onclick = () =>
        (popup.style.display = "flex");

      function closeChat() {
        popup.style.display = "none";
      }

      function sendMessage() {
        let msg = input.value.trim();
        if (!msg) return;

        body.innerHTML += `<div class="user-msg">${msg}</div>`;
        input.value = "";

        fetch("chat_bot/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify({ message: msg }),
        })
          .then((res) => res.json())
          .then((data) => {
            console.log('hii123')
            body.innerHTML += `<div class="bot-msg">${data.reply}</div>`;
            body.scrollTop = body.scrollHeight;
          });
      }

      function getCookie(name) {
        let cookieValue = null;
        document.cookie.split(";").forEach((cookie) => {
          if (cookie.trim().startsWith(name + "=")) {
            cookieValue = decodeURIComponent(
              cookie.trim().substring(name.length + 1)
            );
          }
        });
        return cookieValue;
      }
    </script>
  </body>
</html>

